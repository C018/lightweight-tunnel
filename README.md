# Lightweight Tunnel - è½»é‡çº§å†…ç½‘ç©¿é€éš§é“

<div align="center">

**ä¸€ä¸ªé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿçš„å†…ç½‘ç©¿é€éš§é“å·¥å…·**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Go Version](https://img.shields.io/badge/Go-1.19+-blue.svg)](https://golang.org)
[![Platform](https://img.shields.io/badge/Platform-Linux-green.svg)](https://www.linux.org/)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Lightweight Tunnel æ˜¯ä¸€ä¸ªä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„è½»é‡çº§å†…ç½‘ç©¿é€éš§é“å·¥å…·ã€‚å®ƒé€šè¿‡ **UDP ä¼ è¾“å¹¶ä¼ªè£…æˆ TCP æµé‡**æ¥ç»•è¿‡é˜²ç«å¢™é™åˆ¶ï¼ŒåŒæ—¶å†…ç½® **AES-256-GCM åŠ å¯†**å’Œ **FEC å‰å‘çº é”™**åŠŸèƒ½ï¼Œåœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶æä¾›ç¨³å®šå¯é çš„ç½‘ç»œè¿æ¥ã€‚

### é€‚ç”¨åœºæ™¯

- ğŸ¢ **ä¼ä¸šå†…ç½‘äº’è”**ï¼šåœ¨å¤šä¸ªåˆ†æ”¯æœºæ„ä¹‹é—´å»ºç«‹å®‰å…¨çš„è™šæ‹Ÿå±€åŸŸç½‘
- ğŸ  **å®¶åº­æœåŠ¡å™¨è®¿é—®**ï¼šä»å¤–ç½‘å®‰å…¨è®¿é—®å®¶ä¸­çš„ NASã€æœåŠ¡å™¨ç­‰è®¾å¤‡
- ğŸ® **æ¸¸æˆè”æœº**ï¼šä¸ºå±€åŸŸç½‘æ¸¸æˆå»ºç«‹ä½å»¶è¿Ÿçš„è™šæ‹Ÿå±€åŸŸç½‘
- ğŸ”§ **å¼€å‘æµ‹è¯•**ï¼šåœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸­å¿«é€Ÿå»ºç«‹å¼€å‘æµ‹è¯•ç½‘ç»œ
- ğŸŒ **å¤šç‚¹äº’è”**ï¼šæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯ç»„æˆ Hub ç½‘ç»œï¼Œä»»æ„èŠ‚ç‚¹é—´å¯ç›´æ¥é€šä¿¡

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸš€ é«˜æ€§èƒ½ä¸ç¨³å®šæ€§

- **åŸºäº UDP ä¼ è¾“**ï¼šé¿å… TCP-over-TCP é—®é¢˜ï¼Œå»¶è¿Ÿæ›´ä½ï¼Œæ€§èƒ½æ›´å¥½
- **TCP æµé‡ä¼ªè£…**ï¼šUDP æ•°æ®åŒ…è¢«åŒ…è£…æˆ TCP æ ¼å¼ï¼Œå¯ç©¿é€ä¸¥æ ¼çš„é˜²ç«å¢™
- **FEC å‰å‘çº é”™**ï¼šé€šè¿‡å†—ä½™æ•°æ®è‡ªåŠ¨æ¢å¤ä¸¢å¤±çš„æ•°æ®åŒ…ï¼Œæ— éœ€é‡ä¼ 
- **æ™ºèƒ½é˜Ÿåˆ—ç®¡ç†**ï¼šå¯é…ç½®çš„å‘é€/æ¥æ”¶é˜Ÿåˆ—ï¼Œé€‚åº”ä¸åŒå¸¦å®½ç¯å¢ƒ
- **é«˜å¹¶å‘å¤„ç†**ï¼šåŸºäº Go åç¨‹çš„å¼‚æ­¥å¤„ç†æ¶æ„ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯

### ğŸ” å®‰å…¨ä¸åŠ å¯†

- **AES-256-GCM åŠ å¯†**ï¼šå†›ç”¨çº§åŠ å¯†ç®—æ³•ï¼Œä¿æŠ¤æ‰€æœ‰éš§é“æµé‡
- **å¯†é’¥è®¤è¯æœºåˆ¶**ï¼šåªæœ‰æŒæœ‰æ­£ç¡®å¯†é’¥çš„å®¢æˆ·ç«¯æ‰èƒ½è¿æ¥
- **ç«¯åˆ°ç«¯åŠ å¯†**ï¼šåŒ…æ‹¬æœåŠ¡å™¨ä¸­è½¬å’Œ P2P ç›´è¿åœ¨å†…çš„æ‰€æœ‰æµé‡å‡è¢«åŠ å¯†
- **é˜²çªƒå¬é˜²ç¯¡æ”¹**ï¼šGCM æ¨¡å¼æä¾›è®¤è¯åŠ å¯†ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§

### ğŸŒ ç½‘ç»œæ‹“æ‰‘

- **å¤šå®¢æˆ·ç«¯æ”¯æŒ**ï¼šæœåŠ¡ç«¯é»˜è®¤æ”¯æŒ Hub æ¨¡å¼ï¼Œå¯åŒæ—¶è¿æ¥ 100+ å®¢æˆ·ç«¯
- **P2P ç›´è¿**ï¼šæ”¯æŒ NAT ç©¿é€ï¼Œå®¢æˆ·ç«¯é—´å¯å»ºç«‹ç›´æ¥è¿æ¥
- **æ™ºèƒ½è·¯ç”±é€‰æ‹©**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜è·¯å¾„ï¼ˆP2P > æœåŠ¡å™¨ä¸­è½¬ï¼‰
- **ç½‘çŠ¶ç½‘ç»œæ¶æ„**ï¼šé¢„ç•™å¤šè·³ä¸­ç»§åŠŸèƒ½ï¼ˆå½“å‰ç‰ˆæœ¬æœªå¯ç”¨ï¼‰
- **å®¢æˆ·ç«¯éš”ç¦»æ¨¡å¼**ï¼šå¯é…ç½®å®¢æˆ·ç«¯åªèƒ½ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œäº’ç›¸éš”ç¦»

### ğŸ› ï¸ æ˜“ç”¨æ€§

- **ç®€å•çš„å‘½ä»¤è¡Œç•Œé¢**ï¼šä¸€æ¡å‘½ä»¤å³å¯å¯åŠ¨ï¼Œå‚æ•°è®¾è®¡ç›´è§‚æ˜“æ‡‚
- **çµæ´»çš„é…ç½®æ–¹å¼**ï¼šæ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’Œ JSON é…ç½®æ–‡ä»¶ä¸¤ç§æ–¹å¼
- **è‡ªåŠ¨é…ç½®ç”Ÿæˆ**ï¼šå¯å¿«é€Ÿç”ŸæˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é…ç½®æ¨¡æ¿
- **è¯¦ç»†çš„æ—¥å¿—è¾“å‡º**ï¼šå®æ—¶æ˜¾ç¤ºè¿æ¥çŠ¶æ€ã€è·¯ç”±ä¿¡æ¯å’Œæ€§èƒ½ç»Ÿè®¡
- **è·¨å¹³å°ç¼–è¯‘**ï¼šGo è¯­è¨€ç¼–å†™ï¼Œå¯è½»æ¾ç¼–è¯‘åˆ°ä¸åŒæ¶æ„

---

## ğŸ¯ å·¥ä½œåŸç†

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨å±‚æµé‡                             â”‚
â”‚              (HTTP, SSH, æ¸¸æˆ, ä»»æ„ TCP/UDP åè®®)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TUN è™šæ‹Ÿç½‘å¡                             â”‚
â”‚               (10.0.0.x/24 è™šæ‹Ÿç½‘ç»œæ¥å£)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Lightweight Tunnel                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. IP æ•°æ®åŒ…æ•è· â†’ 2. FEC ç¼–ç  â†’ 3. AES-256-GCM åŠ å¯† â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  UDP + ä¼ªè£… TCP å¤´éƒ¨                          â”‚
â”‚            (å¤–è§‚åƒ TCPï¼Œå®é™…èµ° UDP ä¼ è¾“)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                      ç‰©ç†ç½‘ç»œä¼ è¾“
```

### æŠ€æœ¯ç»†èŠ‚

#### 1. TUN è™šæ‹Ÿç½‘å¡å±‚

- åˆ›å»º Linux TUN è®¾å¤‡ï¼Œåˆ†é…è™šæ‹Ÿ IP åœ°å€ï¼ˆå¦‚ 10.0.0.2/24ï¼‰
- æ•è·å‘å¾€è™šæ‹Ÿç½‘ç»œçš„æ‰€æœ‰ IP æ•°æ®åŒ…
- å°†åº”ç”¨ç¨‹åºçš„ç½‘ç»œæµé‡é€æ˜åœ°å¯¼å…¥éš§é“
- æ”¯æŒæ‰€æœ‰åŸºäº IP çš„åè®®ï¼ˆTCPã€UDPã€ICMP ç­‰ï¼‰

#### 2. FEC å‰å‘çº é”™å±‚

- å°†åŸå§‹æ•°æ®åˆ†å‰²æˆå¤šä¸ªåˆ†ç‰‡ï¼ˆé»˜è®¤ 10 ä¸ªæ•°æ®åˆ†ç‰‡ï¼‰
- ç”Ÿæˆé¢å¤–çš„æ ¡éªŒåˆ†ç‰‡ï¼ˆé»˜è®¤ 3 ä¸ªæ ¡éªŒåˆ†ç‰‡ï¼‰
- æ¥æ”¶ç«¯å¯ä»¥ä»éƒ¨åˆ†åˆ†ç‰‡æ¢å¤å‡ºå®Œæ•´æ•°æ®
- åœ¨å¼±ç½‘ç¯å¢ƒä¸‹æ˜¾è‘—æé«˜ä¼ è¾“å¯é æ€§ï¼Œé¿å…é‡ä¼ 

#### 3. åŠ å¯†å±‚ (å¯é€‰ä½†å¼ºçƒˆæ¨è)

- **ç®—æ³•**ï¼šAES-256-GCMï¼ˆGalois/Counter Modeï¼‰
- **å¯†é’¥æ´¾ç”Ÿ**ï¼šSHA-256 å“ˆå¸Œç”¨æˆ·æä¾›çš„å¯†é’¥å­—ç¬¦ä¸²
- **éšæœº Nonce**ï¼šæ¯ä¸ªæ•°æ®åŒ…ä½¿ç”¨ç‹¬ç«‹çš„éšæœº nonce
- **è®¤è¯æ ‡ç­¾**ï¼š16 å­—èŠ‚çš„è®¤è¯æ ‡ç­¾ç¡®ä¿æ•°æ®å®Œæ•´æ€§
- **å¼€é”€**ï¼šæ¯ä¸ªæ•°æ®åŒ…å¢åŠ  28 å­—èŠ‚ï¼ˆ12 å­—èŠ‚ nonce + 16 å­—èŠ‚æ ‡ç­¾ï¼‰

#### 4. TCP ä¼ªè£…å±‚

- åœ¨ UDP æ•°æ®åŒ…å¤–éƒ¨æ·»åŠ ä¼ªé€ çš„ TCP å¤´éƒ¨
- åŒ…å«æºç«¯å£ã€ç›®æ ‡ç«¯å£ã€åºåˆ—å·ã€ç¡®è®¤å·ç­‰ TCP å­—æ®µ
- ç®€å•çš„é˜²ç«å¢™ä¼šå°†å…¶è¯†åˆ«ä¸º TCP æµé‡
- æ³¨æ„ï¼šæ·±åº¦åŒ…æ£€æµ‹ (DPI) å¯èƒ½è¯†ç ´ä¼ªè£…

#### 5. P2P ç›´è¿æœºåˆ¶

**NAT æ‰“æ´æµç¨‹**ï¼š

```
1. å®¢æˆ·ç«¯ A å’Œå®¢æˆ·ç«¯ B åŒæ—¶è¿æ¥åˆ°æœåŠ¡å™¨
2. æœåŠ¡å™¨è®°å½•ä¸¤ä¸ªå®¢æˆ·ç«¯çš„å…¬ç½‘ IP å’Œç«¯å£
3. æœåŠ¡å™¨å‘é€ PUNCH æŒ‡ä»¤ï¼Œå‘ŠçŸ¥åŒæ–¹å¯¹æ–¹çš„åœ°å€
4. ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘å¯¹æ–¹å‘é€ UDP æ•°æ®åŒ…
5. NAT è®¾å¤‡ä¸ºåŒå‘ UDP æµé‡å¼€æ”¾ç«¯å£æ˜ å°„
6. P2P è¿æ¥å»ºç«‹ï¼Œåç»­æµé‡ç›´æ¥ä¼ è¾“
```

**è·¯ç”±ä¼˜å…ˆçº§**ï¼š
1. ğŸ¥‡ **æœ¬åœ°ç½‘ç»œç›´è¿**ï¼šå¦‚æœåŒæ–¹åœ¨åŒä¸€å±€åŸŸç½‘ï¼Œç›´æ¥ä½¿ç”¨å†…ç½‘ IP
2. ğŸ¥ˆ **P2P å…¬ç½‘ç›´è¿**ï¼šé€šè¿‡ NAT æ‰“æ´å»ºç«‹çš„ç›´æ¥è¿æ¥
3. ğŸ¥‰ **æœåŠ¡å™¨ä¸­è½¬**ï¼šP2P å¤±è´¥æ—¶å›é€€åˆ°æœåŠ¡å™¨è½¬å‘

**P2P å±€é™æ€§**ï¼š
- âœ… **æ”¯æŒ**ï¼šé”¥å½¢ NAT (Cone NAT)ã€ç«¯å£é™åˆ¶é”¥å½¢ NAT
- âš ï¸ **éƒ¨åˆ†æ”¯æŒ**ï¼šå¯¹ç§° NAT (Symmetric NAT) - æˆåŠŸç‡è¾ƒä½
- âŒ **ä¸æ”¯æŒ**ï¼šåŒæ–¹éƒ½æ˜¯ä¸¥æ ¼å¯¹ç§° NAT çš„æƒ…å†µ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

| é¡¹ç›® | è¦æ±‚ |
|------|------|
| æ“ä½œç³»ç»Ÿ | Linux (å†…æ ¸ 2.6+) |
| æƒé™ | Root æˆ– sudo |
| å†…å­˜ | æœ€ä½ 64MBï¼Œæ¨è 128MB+ |
| CPU | ä»»æ„æ¶æ„ (x86_64, ARM, ARM64 ç­‰) |
| ç½‘ç»œ | è‡³å°‘ä¸€å°è®¾å¤‡éœ€è¦å…¬ç½‘ IP æˆ–ç«¯å£è½¬å‘ |

### å®‰è£…æ­¥éª¤

#### æ–¹å¼ 1ï¼šä»æºç ç¼–è¯‘ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/openbmx/lightweight-tunnel.git
cd lightweight-tunnel

# 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœä½¿ç”¨ Go modules ä¼šè‡ªåŠ¨ä¸‹è½½ï¼‰
go mod download

# 3. ç¼–è¯‘
go build -o lightweight-tunnel ./cmd/lightweight-tunnel

# 4. ï¼ˆå¯é€‰ï¼‰å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„
sudo cp lightweight-tunnel /usr/local/bin/

# 5. éªŒè¯å®‰è£…
./lightweight-tunnel -v
```

#### æ–¹å¼ 2ï¼šä½¿ç”¨ Makefile

```bash
# ç¼–è¯‘
make build

# ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½äºï¼šbin/lightweight-tunnel
ls -lh bin/
```

#### æ–¹å¼ 3ï¼šç›´æ¥å®‰è£…åˆ° $GOPATH/bin

```bash
go install github.com/openbmx/lightweight-tunnel/cmd/lightweight-tunnel@latest
```

### åŸºç¡€ä½¿ç”¨æ•™ç¨‹

#### åœºæ™¯ 1ï¼šæœ€ç®€å•çš„åŒç«¯åŠ å¯†éš§é“

è¿™æ˜¯æœ€åŸºæœ¬ä¹Ÿæ˜¯æœ€æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œé€‚åˆå¿«é€Ÿæµ‹è¯•ã€‚

**æœåŠ¡ç«¯**ï¼ˆéœ€è¦å…¬ç½‘ IP æˆ–å…¬ç½‘ç«¯å£è½¬å‘ï¼‰ï¼š
```bash
sudo ./lightweight-tunnel \
  -m server \
  -l 0.0.0.0:9000 \
  -t 10.0.0.1/24 \
  -k "my-secret-password-2024"
```

**å®¢æˆ·ç«¯**ï¼š
```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨å…¬ç½‘IP>:9000 \
  -t 10.0.0.2/24 \
  -k "my-secret-password-2024"
```

**æµ‹è¯•è¿æ¥**ï¼š
```bash
# åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ
ping 10.0.0.1    # ping æœåŠ¡å™¨çš„è™šæ‹Ÿ IP
ping 8.8.8.8      # æµ‹è¯•å¤–ç½‘ï¼ˆéœ€é…ç½®è·¯ç”±ï¼‰
```

**å‚æ•°è¯´æ˜**ï¼š
- `-m`ï¼šè¿è¡Œæ¨¡å¼ï¼ˆserver æœåŠ¡ç«¯ / client å®¢æˆ·ç«¯ï¼‰
- `-l`ï¼šæœåŠ¡ç«¯ç›‘å¬åœ°å€å’Œç«¯å£
- `-r`ï¼šå®¢æˆ·ç«¯è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€
- `-t`ï¼šéš§é“è™šæ‹Ÿ IP åœ°å€å’Œå­ç½‘æ©ç 
- `-k`ï¼š**åŠ å¯†å¯†é’¥**ï¼ˆåŒæ–¹å¿…é¡»ç›¸åŒï¼‰

---

#### åœºæ™¯ 2ï¼šå¤šå®¢æˆ·ç«¯ Hub ç½‘ç»œï¼ˆä¼ä¸šå†…ç½‘äº’è”ï¼‰

æœåŠ¡ç«¯é»˜è®¤å¯ç”¨å¤šå®¢æˆ·ç«¯æ¨¡å¼ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯å¯ä»¥ç›¸äº’è®¿é—®ï¼Œå½¢æˆè™šæ‹Ÿå±€åŸŸç½‘ã€‚

**æœåŠ¡ç«¯**ï¼š
```bash
sudo ./lightweight-tunnel \
  -m server \
  -l 0.0.0.0:9000 \
  -t 10.0.0.1/24 \
  -k "company-secure-key-2024" \
  -max-clients 50
```

**å®¢æˆ·ç«¯ A**ï¼ˆåŒ—äº¬åˆ†å…¬å¸ï¼‰ï¼š
```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.10/24 \
  -k "company-secure-key-2024"
```

**å®¢æˆ·ç«¯ B**ï¼ˆä¸Šæµ·åˆ†å…¬å¸ï¼‰ï¼š
```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.20/24 \
  -k "company-secure-key-2024"
```

**å®¢æˆ·ç«¯ C**ï¼ˆæ·±åœ³åˆ†å…¬å¸ï¼‰ï¼š
```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.30/24 \
  -k "company-secure-key-2024"
```

**åº”ç”¨ç¤ºä¾‹**ï¼š
```bash
# åœ¨å®¢æˆ·ç«¯ A (åŒ—äº¬) ä¸Šè®¿é—®å®¢æˆ·ç«¯ B (ä¸Šæµ·) çš„æœåŠ¡
ssh user@10.0.0.20          # SSH è¿æ¥
mysql -h 10.0.0.20 -u root  # è®¿é—®æ•°æ®åº“
ping 10.0.0.30              # ping æ·±åœ³åˆ†å…¬å¸

# åœ¨å®¢æˆ·ç«¯ B (ä¸Šæµ·) ä¸Šè®¿é—®å®¢æˆ·ç«¯ C (æ·±åœ³) çš„ Web æœåŠ¡
curl http://10.0.0.30:8080
```

---

#### åœºæ™¯ 3ï¼šP2P ç›´è¿æ¨¡å¼ï¼ˆä½å»¶è¿Ÿæ¸¸æˆè”æœºï¼‰

å¯ç”¨ P2P åï¼Œå®¢æˆ·ç«¯ä¼šå°è¯•å»ºç«‹ç›´æ¥è¿æ¥ï¼Œæµé‡ä¸ç»è¿‡æœåŠ¡å™¨ä¸­è½¬ã€‚

**æœåŠ¡ç«¯**ï¼š
```bash
sudo ./lightweight-tunnel \
  -m server \
  -l 0.0.0.0:9000 \
  -t 10.0.0.1/24 \
  -k "gaming-2024"
```

**æ¸¸æˆä¸»æœº 1**ï¼š
```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.100/24 \
  -k "gaming-2024" \
  -p2p \
  -p2p-port 19000
```

**æ¸¸æˆä¸»æœº 2**ï¼š
```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.101/24 \
  -k "gaming-2024" \
  -p2p \
  -p2p-port 19001
```

**æ£€æŸ¥ P2P çŠ¶æ€**ï¼š
ç¨‹åºæ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
```
P2P connection established with 10.0.0.101 (direct)
Routing stats: 1 direct, 0 relay, 0 server
# è¡¨ç¤ºå·²å»ºç«‹ P2P ç›´è¿ï¼Œæµé‡ä¸ç»è¿‡æœåŠ¡å™¨
```

**P2P ä¼˜åŠ¿**ï¼š
- âš¡ **å»¶è¿Ÿæ›´ä½**ï¼šç‚¹å¯¹ç‚¹ç›´è¿ï¼Œé¿å…æœåŠ¡å™¨ä¸­è½¬
- ğŸ’° **èŠ‚çœå¸¦å®½**ï¼šæœåŠ¡å™¨ä¸éœ€è¦è½¬å‘æµé‡
- ğŸ”’ **åŒæ ·å®‰å…¨**ï¼šP2P æµé‡ä¹Ÿä½¿ç”¨ AES-256-GCM åŠ å¯†

---

#### åœºæ™¯ 4ï¼šå®¢æˆ·ç«¯éš”ç¦»æ¨¡å¼ï¼ˆå®‰å…¨éœ€æ±‚ï¼‰

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å®¢æˆ·ç«¯åªèƒ½è®¿é—®æœåŠ¡ç«¯ï¼Œè€Œä¸èƒ½ç›¸äº’è®¿é—®ã€‚

**æœåŠ¡ç«¯**ï¼š
```bash
sudo ./lightweight-tunnel \
  -m server \
  -l 0.0.0.0:9000 \
  -t 10.0.0.1/24 \
  -k "isolated-network" \
  -client-isolation
```

æ­¤æ¨¡å¼ä¸‹ï¼š
- âœ… å®¢æˆ·ç«¯å¯ä»¥è®¿é—® 10.0.0.1 (æœåŠ¡ç«¯)
- âŒ å®¢æˆ·ç«¯ A æ— æ³•è®¿é—®å®¢æˆ·ç«¯ B
- âœ… æœåŠ¡ç«¯å¯ä»¥è®¿é—®æ‰€æœ‰å®¢æˆ·ç«¯

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¸­å¿ƒåŒ–çš„æœåŠ¡æ¶æ„ï¼ˆæ‰€æœ‰å®¢æˆ·ç«¯åªè®¿é—®ä¸­å¿ƒæœåŠ¡å™¨ï¼‰
- å®‰å…¨è¦æ±‚è¾ƒé«˜çš„ç¯å¢ƒï¼ˆé˜²æ­¢å®¢æˆ·ç«¯é—´æ”»å‡»ï¼‰
- VPN åœºæ™¯ï¼ˆå®¢æˆ·ç«¯ä¸éœ€è¦ç›¸äº’é€šä¿¡ï¼‰

---

### ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

å¯¹äºç”Ÿäº§ç¯å¢ƒæˆ–å¤æ‚é…ç½®ï¼Œæ¨èä½¿ç”¨ JSON é…ç½®æ–‡ä»¶ã€‚

#### ç”Ÿæˆé…ç½®æ¨¡æ¿

```bash
./lightweight-tunnel -g myconfig.json
```

è¿™ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š
- `myconfig.json` - æœåŠ¡ç«¯é…ç½®æ¨¡æ¿
- `myconfig.json.client` - å®¢æˆ·ç«¯é…ç½®æ¨¡æ¿

#### æœåŠ¡ç«¯å®Œæ•´é…ç½®ç¤ºä¾‹

**config-server.json**ï¼š
```json
{
  "mode": "server",
  "local_addr": "0.0.0.0:9000",
  "tunnel_addr": "10.0.0.1/24",
  "key": "change-this-to-your-strong-secret-key",
  "mtu": 1400,
  "fec_data": 10,
  "fec_parity": 3,
  "timeout": 30,
  "keepalive": 10,
  "send_queue_size": 1000,
  "recv_queue_size": 1000,
  "multi_client": true,
  "max_clients": 100,
  "client_isolation": false
}
```

**é…ç½®è¯´æ˜**ï¼š

| å­—æ®µ | è¯´æ˜ | æ¨èå€¼ |
|------|------|--------|
| `mode` | è¿è¡Œæ¨¡å¼ | `server` æˆ– `client` |
| `local_addr` | ç›‘å¬åœ°å€ï¼ˆæœåŠ¡ç«¯ï¼‰ | `0.0.0.0:9000` |
| `tunnel_addr` | è™šæ‹Ÿç½‘ç»œåœ°å€ | `10.0.0.1/24` |
| `key` | åŠ å¯†å¯†é’¥ | 16+ å­—ç¬¦çš„å¼ºå¯†ç  |
| `mtu` | æœ€å¤§ä¼ è¾“å•å…ƒ | 1400 (æ ‡å‡†ç½‘ç»œ)<br>1200 (å¼±ç½‘)<br>8000 (å†…ç½‘) |
| `fec_data` | FEC æ•°æ®åˆ†ç‰‡æ•° | 10 (æ ‡å‡†)<br>20 (ä½ä¸¢åŒ…) |
| `fec_parity` | FEC æ ¡éªŒåˆ†ç‰‡æ•° | 3 (æ ‡å‡†)<br>5 (é«˜ä¸¢åŒ…) |
| `timeout` | è¿æ¥è¶…æ—¶ç§’æ•° | 30 |
| `keepalive` | å¿ƒè·³é—´éš”ç§’æ•° | 10 |
| `send_queue_size` | å‘é€é˜Ÿåˆ—å¤§å° | 1000-5000 |
| `recv_queue_size` | æ¥æ”¶é˜Ÿåˆ—å¤§å° | 1000-5000 |
| `multi_client` | å¯ç”¨å¤šå®¢æˆ·ç«¯ | `true` (Hub æ¨¡å¼)<br>`false` (ç‚¹å¯¹ç‚¹) |
| `max_clients` | æœ€å¤§å®¢æˆ·ç«¯æ•° | 100 |
| `client_isolation` | å®¢æˆ·ç«¯éš”ç¦» | `false` (å¯äº’è®¿)<br>`true` (éš”ç¦») |

#### å®¢æˆ·ç«¯å®Œæ•´é…ç½®ç¤ºä¾‹

**config-client.json**ï¼š
```json
{
  "mode": "client",
  "remote_addr": "your-server-ip:9000",
  "tunnel_addr": "10.0.0.2/24",
  "key": "change-this-to-your-strong-secret-key",
  "mtu": 1400,
  "fec_data": 10,
  "fec_parity": 3,
  "timeout": 30,
  "keepalive": 10,
  "send_queue_size": 1000,
  "recv_queue_size": 1000,
  "p2p_enabled": true,
  "p2p_port": 0,
  "enable_mesh_routing": true,
  "max_hops": 3,
  "route_update_interval": 30,
  "p2p_timeout": 5
}
```

**P2P ç›¸å…³é…ç½®è¯´æ˜**ï¼š

| å­—æ®µ | è¯´æ˜ | æ¨èå€¼ |
|------|------|--------|
| `p2p_enabled` | å¯ç”¨ P2P ç›´è¿ | `true` |
| `p2p_port` | P2P UDP ç«¯å£ | `0` (è‡ªåŠ¨åˆ†é…) æˆ–æŒ‡å®šç«¯å£ |
| `enable_mesh_routing` | å¯ç”¨ç½‘çŠ¶è·¯ç”± | `true` |
| `max_hops` | æœ€å¤§ä¸­ç»§è·³æ•° | 3 |
| `route_update_interval` | è·¯ç”±æ›´æ–°é—´éš” | 30 ç§’ |
| `p2p_timeout` | P2P è¶…æ—¶ | 5 ç§’ |

#### ä½¿ç”¨é…ç½®æ–‡ä»¶è¿è¡Œ

```bash
# æœåŠ¡ç«¯
sudo ./lightweight-tunnel -c config-server.json

# å®¢æˆ·ç«¯
sudo ./lightweight-tunnel -c config-client.json
```

---

## âš™ï¸ é…ç½®å‚æ•°è¯¦è§£

### å‘½ä»¤è¡Œå‚æ•°å®Œæ•´åˆ—è¡¨

```
åŸºæœ¬å‚æ•°ï¼š
  -c string
        é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆä½¿ç”¨ JSON æ–‡ä»¶é…ç½®ï¼‰
  -m string
        è¿è¡Œæ¨¡å¼ï¼šserverï¼ˆæœåŠ¡ç«¯ï¼‰æˆ– clientï¼ˆå®¢æˆ·ç«¯ï¼‰
        é»˜è®¤å€¼ï¼šserver
  -v    æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
  -g string
        ç”Ÿæˆç¤ºä¾‹é…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„

ç½‘ç»œé…ç½®ï¼š
  -l string
        ç›‘å¬åœ°å€ï¼ˆä»…æœåŠ¡ç«¯ä½¿ç”¨ï¼‰
        æ ¼å¼ï¼šIP:ç«¯å£
        é»˜è®¤å€¼ï¼š0.0.0.0:9000
        ç¤ºä¾‹ï¼š-l 0.0.0.0:9000
  -r string
        è¿œç¨‹æœåŠ¡å™¨åœ°å€ï¼ˆä»…å®¢æˆ·ç«¯ä½¿ç”¨ï¼‰
        æ ¼å¼ï¼šIP:ç«¯å£
        ç¤ºä¾‹ï¼š-r 1.2.3.4:9000
  -t string
        éš§é“è™šæ‹Ÿ IP åœ°å€å’Œå­ç½‘æ©ç 
        æ ¼å¼ï¼šIP/CIDR
        é»˜è®¤å€¼ï¼š10.0.0.1/24
        ç¤ºä¾‹ï¼š-t 10.0.0.2/24

åŠ å¯†é…ç½®ï¼š
  -k string
        åŠ å¯†å¯†é’¥ï¼ˆå¼ºçƒˆæ¨èè®¾ç½®ï¼‰
        ä¸è®¾ç½®åˆ™æµé‡æ˜æ–‡ä¼ è¾“ï¼ˆä»…ä¾›æµ‹è¯•ï¼‰
        ç¤ºä¾‹ï¼š-k "my-secret-password-2024"

æ€§èƒ½ä¼˜åŒ–ï¼š
  -mtu int
        æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆå­—èŠ‚ï¼‰
        é»˜è®¤å€¼ï¼š1400
        æ¨èå€¼ï¼š
          - æ ‡å‡†ç½‘ç»œï¼š1400
          - å¼±ç½‘ç¯å¢ƒï¼š1200
          - é«˜é€Ÿå†…ç½‘ï¼š8000
  -send-queue int
        å‘é€é˜Ÿåˆ—ç¼“å†²åŒºå¤§å°
        é»˜è®¤å€¼ï¼š1000
        é«˜å¸¦å®½åœºæ™¯æ¨èï¼š5000-10000
  -recv-queue int
        æ¥æ”¶é˜Ÿåˆ—ç¼“å†²åŒºå¤§å°
        é»˜è®¤å€¼ï¼š1000
        é«˜å¸¦å®½åœºæ™¯æ¨èï¼š5000-10000

FEC çº é”™é…ç½®ï¼š
  -fec-data int
        FEC æ•°æ®åˆ†ç‰‡æ•°é‡
        é»˜è®¤å€¼ï¼š10
        æ¨èå€¼ï¼š
          - ä½ä¸¢åŒ…ç½‘ç»œï¼š20
          - æ ‡å‡†ç½‘ç»œï¼š10
          - é«˜ä¸¢åŒ…ç½‘ç»œï¼š10
  -fec-parity int
        FEC æ ¡éªŒåˆ†ç‰‡æ•°é‡
        é»˜è®¤å€¼ï¼š3
        æ¨èå€¼ï¼š
          - ä½ä¸¢åŒ…ç½‘ç»œï¼š2
          - æ ‡å‡†ç½‘ç»œï¼š3
          - é«˜ä¸¢åŒ…ç½‘ç»œï¼š5

æœåŠ¡ç«¯å¤šå®¢æˆ·ç«¯é…ç½®ï¼š
  -multi-client
        å¯ç”¨å¤šå®¢æˆ·ç«¯æ”¯æŒï¼ˆHub æ¨¡å¼ï¼‰
        é»˜è®¤å€¼ï¼štrue
  -max-clients int
        æœ€å¤§å¹¶å‘å®¢æˆ·ç«¯æ•°é‡
        é»˜è®¤å€¼ï¼š100
  -client-isolation
        å¯ç”¨å®¢æˆ·ç«¯éš”ç¦»ï¼ˆå®¢æˆ·ç«¯é—´ä¸èƒ½äº’è®¿ï¼‰
        é»˜è®¤å€¼ï¼šfalse

P2P ç›´è¿é…ç½®ï¼š
  -p2p
        å¯ç”¨ P2P ç›´æ¥è¿æ¥
        é»˜è®¤å€¼ï¼štrue
  -p2p-port int
        P2P UDP ç›‘å¬ç«¯å£
        é»˜è®¤å€¼ï¼š0ï¼ˆè‡ªåŠ¨åˆ†é…ï¼‰
        ç¤ºä¾‹ï¼š-p2p-port 19000
  -mesh-routing
        å¯ç”¨ç½‘çŠ¶ç½‘ç»œè·¯ç”±
        é»˜è®¤å€¼ï¼štrue
  -max-hops int
        ç½‘çŠ¶ç½‘ç»œæœ€å¤§è·³æ•°
        é»˜è®¤å€¼ï¼š3
  -route-update int
        è·¯ç”±è´¨é‡æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰
        é»˜è®¤å€¼ï¼š30
```

### æ€§èƒ½è°ƒä¼˜å»ºè®®

#### é«˜é€Ÿå†…ç½‘ç¯å¢ƒï¼ˆåƒå…†/ä¸‡å…†ï¼‰

```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.2/24 \
  -k "my-key" \
  -mtu 8000 \
  -fec-data 20 \
  -fec-parity 2 \
  -send-queue 5000 \
  -recv-queue 5000
```

**ä¼˜åŒ–è¯´æ˜**ï¼š
- å¤§ MTU (8000)ï¼šå‡å°‘æ•°æ®åŒ…æ•°é‡ï¼Œé™ä½ CPU å¼€é”€
- å°‘ FEC å†—ä½™ï¼šå†…ç½‘ä¸¢åŒ…ç‡ä½ï¼Œå‡å°‘å†—ä½™èŠ‚çœå¸¦å®½
- å¤§é˜Ÿåˆ—ï¼šåº”å¯¹çªå‘æµé‡

#### å¼±ç½‘ç¯å¢ƒï¼ˆç§»åŠ¨ç½‘ç»œ/é«˜ä¸¢åŒ…ï¼‰

```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.2/24 \
  -k "my-key" \
  -mtu 1200 \
  -fec-data 10 \
  -fec-parity 5 \
  -send-queue 2000 \
  -recv-queue 2000
```

**ä¼˜åŒ–è¯´æ˜**ï¼š
- å° MTU (1200)ï¼šé™ä½å•åŒ…ä¸¢å¤±å½±å“
- å¤š FEC å†—ä½™ï¼šæ›´å¼ºçš„æ¢å¤èƒ½åŠ›
- ä¸­ç­‰é˜Ÿåˆ—ï¼šå¹³è¡¡å†…å­˜å’Œæ€§èƒ½

#### æ ‡å‡†äº’è”ç½‘ç¯å¢ƒï¼ˆå®¶åº­å®½å¸¦ï¼‰

```bash
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.2/24 \
  -k "my-key" \
  -mtu 1400 \
  -fec-data 10 \
  -fec-parity 3 \
  -send-queue 1000 \
  -recv-queue 1000
```

**è¯´æ˜**ï¼šä½¿ç”¨é»˜è®¤é…ç½®å³å¯æ»¡è¶³å¤§å¤šæ•°åœºæ™¯ã€‚

---

## ğŸ” å¸¸è§é—®é¢˜ä¸æ•…éšœæ’é™¤

### Q1: æƒé™é”™è¯¯ "permission denied"

**é”™è¯¯ä¿¡æ¯**ï¼š
```
failed to open /dev/net/tun: permission denied
```

**åŸå› **ï¼šåˆ›å»º TUN è®¾å¤‡éœ€è¦ root æƒé™ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä½¿ç”¨ sudo è¿è¡Œ
sudo ./lightweight-tunnel -m server ...
```

### Q2: TUN è®¾å¤‡ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
/dev/net/tun: no such file or directory
```

**åŸå› **ï¼šç³»ç»ŸæœªåŠ è½½ TUN/TAP å†…æ ¸æ¨¡å—ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ‰‹åŠ¨åŠ è½½ TUN æ¨¡å—
sudo modprobe tun

# éªŒè¯è®¾å¤‡æ˜¯å¦å­˜åœ¨
ls -l /dev/net/tun

# è®¾ç½®å¼€æœºè‡ªåŠ¨åŠ è½½
echo "tun" | sudo tee -a /etc/modules
```

### Q3: å®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦è¿è¡Œ**ï¼š
```bash
# åœ¨æœåŠ¡ç«¯æ‰§è¡Œ
sudo netstat -tulnp | grep 9000
# æˆ–
sudo ss -tulnp | grep 9000
```

2. **æ£€æŸ¥é˜²ç«å¢™è§„åˆ™**ï¼š
```bash
# Ubuntu/Debian
sudo ufw status
sudo ufw allow 9000/tcp
sudo ufw allow 9000/udp

# CentOS/RHEL
sudo firewall-cmd --list-all
sudo firewall-cmd --add-port=9000/tcp --permanent
sudo firewall-cmd --add-port=9000/udp --permanent
sudo firewall-cmd --reload
```

3. **æµ‹è¯•ç½‘ç»œè¿é€šæ€§**ï¼š
```bash
# ping æµ‹è¯•
ping <æœåŠ¡å™¨IP>

# telnet æµ‹è¯•ç«¯å£
telnet <æœåŠ¡å™¨IP> 9000
```

4. **æ£€æŸ¥ NAT/è·¯ç”±å™¨ç«¯å£è½¬å‘**ï¼š
å¦‚æœæœåŠ¡å™¨åœ¨ NAT åé¢ï¼Œç¡®ä¿è·¯ç”±å™¨é…ç½®äº†ç«¯å£è½¬å‘ï¼š
- å¤–éƒ¨ç«¯å£ 9000 â†’ å†…éƒ¨ IP:9000 (TCP + UDP)

### Q4: å¯†é’¥ä¸åŒ¹é…å¯¼è‡´è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼ˆæœåŠ¡ç«¯æ—¥å¿—ï¼‰**ï¼š
```
Decryption error (wrong key?)
Client authentication failed
```

**åŸå› **ï¼šæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä½¿ç”¨äº†ä¸åŒçš„åŠ å¯†å¯†é’¥ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç¡®ä¿æœåŠ¡ç«¯å’Œæ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ `-k` å‚æ•°ï¼š

```bash
# æœåŠ¡ç«¯
sudo ./lightweight-tunnel -m server -k "exactly-same-password" ...

# å®¢æˆ·ç«¯ï¼ˆå¯†é’¥å¿…é¡»ä¸€å­—ä¸å·®ï¼‰
sudo ./lightweight-tunnel -m client -k "exactly-same-password" ...
```

**æ³¨æ„äº‹é¡¹**ï¼š
- å¯†é’¥åŒºåˆ†å¤§å°å†™
- æ³¨æ„ç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦
- å»ºè®®ä½¿ç”¨å¼•å·åŒ…è£¹å¯†é’¥

### Q5: ç¬¬äºŒä¸ªå®¢æˆ·ç«¯è¿æ¥è¢«æ‹’ç»

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Network read error: EOF
Connection closed by remote host
```

**åŸå› **ï¼šæœåŠ¡ç«¯é…ç½®ä¸ºå•å®¢æˆ·ç«¯æ¨¡å¼ (`multi_client: false`)ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

å‘½ä»¤è¡Œæ–¹å¼ï¼š
```bash
# ç¡®ä¿å¯ç”¨å¤šå®¢æˆ·ç«¯ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
sudo ./lightweight-tunnel -m server -multi-client=true ...
```

é…ç½®æ–‡ä»¶æ–¹å¼ï¼š
```json
{
  "mode": "server",
  "multi_client": true,
  "max_clients": 100
}
```

### Q6: P2P è¿æ¥å¤±è´¥ï¼Œæµé‡èµ°æœåŠ¡å™¨ä¸­è½¬

**ç°è±¡**ï¼šæ—¥å¿—æ˜¾ç¤º "P2P connection failed, using server relay"

**å¯èƒ½åŸå› **ï¼š

1. **åŒæ–¹éƒ½æ˜¯å¯¹ç§° NAT**ï¼š
   - å¯¹ç§° NAT ä¸‹ UDP æ‰“æ´æˆåŠŸç‡ä½
   - æ— æ³•è§£å†³ï¼Œåªèƒ½ä½¿ç”¨æœåŠ¡å™¨ä¸­è½¬

2. **é˜²ç«å¢™é˜»æ­¢ UDP**ï¼š
   - æ£€æŸ¥å®¢æˆ·ç«¯é˜²ç«å¢™è®¾ç½®
   - å…è®¸ P2P ç«¯å£çš„ UDP æµé‡

3. **P2P ç«¯å£è¢«å ç”¨**ï¼š
   - å°è¯•æŒ‡å®šä¸åŒçš„ P2P ç«¯å£
   - ä½¿ç”¨ `-p2p-port` å‚æ•°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®¢æˆ·ç«¯ 1
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.2/24 \
  -k "key" \
  -p2p \
  -p2p-port 19000

# å®¢æˆ·ç«¯ 2
sudo ./lightweight-tunnel \
  -m client \
  -r <æœåŠ¡å™¨IP>:9000 \
  -t 10.0.0.3/24 \
  -k "key" \
  -p2p \
  -p2p-port 19001
```

### Q7: ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
bind: address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹**ï¼š
```bash
sudo lsof -i :9000
# æˆ–
sudo netstat -tulnp | grep 9000
```

2. **ç»ˆæ­¢å ç”¨çš„è¿›ç¨‹**ï¼š
```bash
sudo kill -9 <PID>
```

3. **æˆ–ä½¿ç”¨ä¸åŒçš„ç«¯å£**ï¼š
```bash
sudo ./lightweight-tunnel -m server -l 0.0.0.0:9001 ...
```

### Q8: æ€§èƒ½ä¸ä½³æˆ–å»¶è¿Ÿé«˜

**æ’æŸ¥æ–¹å‘**ï¼š

1. **æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ P2P**ï¼š
   - æŸ¥çœ‹æ—¥å¿—ä¸­çš„è·¯ç”±ç»Ÿè®¡
   - P2P ç›´è¿å»¶è¿Ÿæ›´ä½

2. **è°ƒæ•´ MTU**ï¼š
   - å° MTU å¢åŠ  CPU å¼€é”€ä½†å‡å°‘ä¸¢åŒ…å½±å“
   - å¤§ MTU æé«˜ååé‡ä½†ä¸¢åŒ…å½±å“å¤§

3. **è°ƒæ•´ FEC å‚æ•°**ï¼š
   - è¿‡å¤šå†—ä½™æµªè´¹å¸¦å®½
   - è¿‡å°‘å†—ä½™æ— æ³•æœ‰æ•ˆçº é”™

4. **å¢å¤§é˜Ÿåˆ—**ï¼š
```bash
sudo ./lightweight-tunnel \
  -send-queue 5000 \
  -recv-queue 5000 \
  ...
```

### Q9: çœ‹åˆ° "Send queue full, dropping packet" è­¦å‘Š

**åŸå› **ï¼šå‘é€é˜Ÿåˆ—æº¢å‡ºï¼Œæ•°æ®åŒ…è¢«ä¸¢å¼ƒã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¢å¤§å‘é€å’Œæ¥æ”¶é˜Ÿåˆ—
sudo ./lightweight-tunnel \
  -send-queue 5000 \
  -recv-queue 5000 \
  ...
```

### Q10: å¦‚ä½•æŸ¥çœ‹å®æ—¶è¿æ¥çŠ¶æ€ï¼Ÿ

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š
```
=== Lightweight Tunnel ===
Version: 1.0.0
Mode: client
Tunnel Address: 10.0.0.2/24
MTU: 1400
ğŸ” Encryption: Enabled (AES-256-GCM)

Client connected successfully
P2P connection established with 10.0.0.3 (direct)
Routing stats: 2 peers, 1 direct, 0 relay, 1 server
```

**å®æ—¶ç›‘æ§å·¥å…·**ï¼š
```bash
# æŸ¥çœ‹ç½‘ç»œæ¥å£æµé‡
sudo iftop -i tun0

# æŸ¥çœ‹è™šæ‹Ÿç½‘å¡ç»Ÿè®¡
ifconfig tun0
# æˆ–
ip -s link show tun0
```

---

## ğŸ” å®‰å…¨é…ç½®æœ€ä½³å®è·µ

### 1. å§‹ç»ˆä½¿ç”¨å¼ºåŠ å¯†å¯†é’¥

âŒ **ä¸å®‰å…¨çš„ç¤ºä¾‹**ï¼š
```bash
-k "123456"
-k "password"
-k ""  # æ— åŠ å¯†
```

âœ… **å®‰å…¨çš„ç¤ºä¾‹**ï¼š
```bash
-k "xK9$mN2#pQ7&vL4@wR8*zT3!yU6%"
-k "MyCompany-Secure-Tunnel-2024-Winter"
```

**å¯†é’¥ç”Ÿæˆå»ºè®®**ï¼š
```bash
# ç”Ÿæˆéšæœºå¯†é’¥ï¼ˆLinux/Macï¼‰
openssl rand -base64 32

# æˆ–ä½¿ç”¨å¯†ç ç®¡ç†å™¨ç”Ÿæˆ
# æ¨èé•¿åº¦ï¼š16-64 å­—ç¬¦
# åŒ…å«ï¼šå¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
```

### 2. å¯†é’¥ç®¡ç†

**ä½¿ç”¨ç¯å¢ƒå˜é‡**ï¼ˆé¿å…å‘½ä»¤è¡Œæ˜æ–‡ï¼‰ï¼š
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export TUNNEL_KEY="your-secret-key"

# ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦ä¿®æ”¹ç¨‹åºæ”¯æŒï¼‰
sudo -E ./lightweight-tunnel -m client -k "$TUNNEL_KEY" ...
```

**ä½¿ç”¨é…ç½®æ–‡ä»¶**ï¼ˆè®¾ç½®é€‚å½“æƒé™ï¼‰ï¼š
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > config.json << EOF
{
  "key": "your-secret-key",
  ...
}
EOF

# è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆä»… root å¯è¯»ï¼‰
sudo chmod 600 config.json
sudo chown root:root config.json

# ä½¿ç”¨é…ç½®æ–‡ä»¶
sudo ./lightweight-tunnel -c config.json
```

### 3. ç½‘ç»œéš”ç¦»å»ºè®®

**ä½¿ç”¨ç‹¬ç«‹çš„è™šæ‹Ÿç½‘æ®µ**ï¼š
```bash
# é¿å…ä¸ç°æœ‰ç½‘ç»œå†²çª
# å¸¸ç”¨å†…ç½‘ç½‘æ®µï¼š
-t 10.0.0.1/24    # 10.0.0.0 - 10.0.0.255
-t 172.16.0.1/16  # 172.16.0.0 - 172.16.255.255
-t 192.168.100.1/24  # 192.168.100.0 - 192.168.100.255
```

**é…ç½®é˜²ç«å¢™è§„åˆ™**ï¼š
```bash
# åªå…è®¸éš§é“æµé‡
sudo iptables -A INPUT -i tun0 -s 10.0.0.0/24 -j ACCEPT
sudo iptables -A INPUT -i tun0 -j DROP

# é™åˆ¶è¿æ¥é€Ÿç‡
sudo iptables -A INPUT -p tcp --dport 9000 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT
```

### 4. æ—¥å¿—å’Œç›‘æ§

**å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼š
```bash
sudo ./lightweight-tunnel -m server ... 2>&1 | tee -a /var/log/tunnel.log
```

**å®šæœŸå®¡è®¡**ï¼š
- æ£€æŸ¥å¼‚å¸¸è¿æ¥
- ç›‘æ§æµé‡æ¨¡å¼
- å®¡æŸ¥å¯†é’¥æ›´æ¢è®°å½•

### 5. å®šæœŸæ›´æ–°

```bash
# å®šæœŸæ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°ç¼–è¯‘
go build -o lightweight-tunnel ./cmd/lightweight-tunnel

# é‡å¯æœåŠ¡
sudo systemctl restart lightweight-tunnel
```

---

## ğŸ“Š æ¶æ„è®¾è®¡ä¸æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆé€‰æ‹© UDP è€Œé TCPï¼Ÿ

#### TCP-over-TCP é—®é¢˜

å½“ä½¿ç”¨ TCP ä½œä¸ºéš§é“ä¼ è¾“åè®®æ—¶ï¼Œä¼šå‡ºç°ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å±‚ TCP è¿æ¥ï¼ˆå¦‚ SSHã€HTTPï¼‰     â”‚
â”‚   - æœ‰è‡ªå·±çš„é‡ä¼ æœºåˆ¶                  â”‚
â”‚   - æœ‰è‡ªå·±çš„æ‹¥å¡æ§åˆ¶                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   éš§é“å±‚ TCP è¿æ¥ï¼ˆå¤–å±‚ä¼ è¾“ï¼‰          â”‚
â”‚   - ä¹Ÿæœ‰é‡ä¼ æœºåˆ¶                      â”‚
â”‚   - ä¹Ÿæœ‰æ‹¥å¡æ§åˆ¶                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**ï¼š
1. **åŒé‡é‡ä¼ **ï¼šä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œä¸¤å±‚ TCP éƒ½ä¼šé‡ä¼ 
2. **çº§è”è¶…æ—¶**ï¼šå¤–å±‚ TCP çš„é‡ä¼ è¢«å†…å±‚ TCP è¯¯è®¤ä¸ºç½‘ç»œæ‹¥å¡
3. **æ€§èƒ½å´©æºƒ**ï¼šåœ¨ 10% ä¸¢åŒ…ç‡ä¸‹ï¼Œååé‡å¯é™è‡³åŸæ¥çš„ 1/10

#### æœ¬é¡¹ç›®çš„è§£å†³æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å±‚æµé‡ï¼ˆä»»æ„åè®®ï¼‰               â”‚
â”‚   - TCP/UDP/ICMP ç­‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Lightweight Tunnel                â”‚
â”‚   - FEC çº é”™ï¼ˆæ— éœ€é‡ä¼ ï¼‰              â”‚
â”‚   - UDP ä¼ è¾“ï¼ˆæ— æ‹¥å¡æ§åˆ¶å¹²æ‰°ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- âœ… é¿å…åŒé‡é‡ä¼ 
- âœ… å»¶è¿Ÿæ›´ä½æ›´ç¨³å®š
- âœ… é€‚åˆå®æ—¶åº”ç”¨ï¼ˆæ¸¸æˆã€VoIPï¼‰
- âœ… FEC ä¸»åŠ¨çº é”™ï¼Œä¸ç­‰å¾…é‡ä¼ 

### TCP ä¼ªè£…æŠ€æœ¯

#### ä¼ªè£…åŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ä¼ªè£…çš„ TCP æ•°æ®åŒ…                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  IP Header (20 bytes)                            â”‚
â”‚  - Source IP, Dest IP                            â”‚
â”‚  - Protocol: TCP (6)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TCP Header (20 bytes)                           â”‚
â”‚  - Source Port, Dest Port                        â”‚
â”‚  - Seq Number, Ack Number                        â”‚
â”‚  - Flags: ACK, PSH, etc.                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Payload (encrypted data)                        â”‚
â”‚  - å®é™…æ˜¯ UDP æ•°æ®                                â”‚
â”‚  - ä½†å¤–è§‚åƒ TCP æµé‡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æœ‰æ•ˆæ€§ä¸å±€é™æ€§

**èƒ½éª—è¿‡**ï¼š
- âœ… åŸºäºç«¯å£å·çš„é˜²ç«å¢™
- âœ… ç®€å•çš„åŒ…è¿‡æ»¤è§„åˆ™
- âœ… åªæ£€æŸ¥åè®®å­—æ®µçš„ DPI

**éª—ä¸è¿‡**ï¼š
- âŒ çŠ¶æ€æ£€æµ‹é˜²ç«å¢™ï¼ˆæ£€æŸ¥ TCP æ¡æ‰‹ï¼‰
- âŒ æ·±åº¦åŒ…æ£€æµ‹ï¼ˆDPIï¼‰- æ£€æŸ¥è½½è·ç†µå€¼
- âŒ é«˜çº§ IDS/IPSï¼ˆæ£€æµ‹ä¼ªé€ ç‰¹å¾ï¼‰

**å®é™…æ•ˆæœ**ï¼š
- åœ¨å¤§å¤šæ•°å®¶åº­/ä¼ä¸šç½‘ç»œä¸­æœ‰æ•ˆ
- å¯ç»•è¿‡ç®€å•çš„ UDP å°é”
- ä¸èƒ½ä¿è¯åœ¨æ‰€æœ‰ç¯å¢ƒä¸‹æœ‰æ•ˆ

### FEC å‰å‘çº é”™ç®—æ³•

#### åŸºæœ¬åŸç†

```
åŸå§‹æ•°æ®ï¼šD1 D2 D3 D4 D5 D6 D7 D8 D9 D10
           â†“
FEC ç¼–ç ï¼ˆ10 æ•°æ® + 3 æ ¡éªŒï¼‰ï¼š
    D1  D2  D3  D4  D5  D6  D7  D8  D9  D10  P1  P2  P3
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              æ•°æ®åˆ†ç‰‡                        æ ¡éªŒåˆ†ç‰‡

æ¥æ”¶ç«¯ï¼š
    D1  X   D3  D4  D5  D6  X   D8  D9  D10  P1  P2  P3
        â†‘                       â†‘
        ä¸¢å¤±                    ä¸¢å¤±

FEC è§£ç ï¼š
    âœ… å¯ä»¥æ¢å¤ï¼šä¸¢å¤± 2 ä¸ªåˆ†ç‰‡ï¼Œæœ‰ 3 ä¸ªæ ¡éªŒåˆ†ç‰‡
    âœ… æ— éœ€é‡ä¼ ï¼šç›´æ¥ä»å‰©ä½™åˆ†ç‰‡æ¢å¤å®Œæ•´æ•°æ®
```

#### å‚æ•°é€‰æ‹©

| ç½‘ç»œç¯å¢ƒ | fec-data | fec-parity | å¯æ¢å¤ä¸¢åŒ…ç‡ | å¸¦å®½å¼€é”€ |
|---------|----------|------------|-------------|---------|
| ä½ä¸¢åŒ… (<1%) | 20 | 2 | 9% | 10% |
| æ ‡å‡† (1-3%) | 10 | 3 | 23% | 30% |
| é«˜ä¸¢åŒ… (3-10%) | 10 | 5 | 33% | 50% |
| æç«¯ (>10%) | 8 | 6 | 43% | 75% |

**è®¡ç®—å…¬å¼**ï¼š
- å¯æ¢å¤ä¸¢åŒ…ç‡ = `fec-parity / (fec-data + fec-parity)`
- å¸¦å®½å¼€é”€ = `fec-parity / fec-data`

### P2P NAT ç©¿é€

#### æ”¯æŒçš„ NAT ç±»å‹

| NAT ç±»å‹ | æè¿° | P2P æˆåŠŸç‡ | è¯´æ˜ |
|---------|------|-----------|------|
| å®Œå…¨é”¥å½¢ (Full Cone) | æœ€å®½æ¾ | âœ… 99% | ä»»ä½•å¤–éƒ¨ä¸»æœºéƒ½å¯è¿æ¥ |
| é™åˆ¶é”¥å½¢ (Restricted Cone) | é™åˆ¶ IP | âœ… 95% | åªæœ‰é€šä¿¡è¿‡çš„ IP å¯è¿æ¥ |
| ç«¯å£é™åˆ¶é”¥å½¢ (Port Restricted) | é™åˆ¶ IP+Port | âœ… 90% | åªæœ‰é€šä¿¡è¿‡çš„ IP:Port å¯è¿æ¥ |
| å¯¹ç§°å‹ (Symmetric) | æœ€ä¸¥æ ¼ | âš ï¸ 30% | æ¯ä¸ªç›®æ ‡ä½¿ç”¨ä¸åŒçš„ç«¯å£æ˜ å°„ |

#### æ‰“æ´æµç¨‹è¯¦è§£

```
ç¬¬ 1 æ­¥ï¼šå®¢æˆ·ç«¯æ³¨å†Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client A â”‚ â”€â”€â”€â”€æ³¨å†Œâ”€â”€â”€â”€â”€â”€â”€â†’   â”‚  Server  â”‚
â”‚ (NAT-A)  â”‚ â†â”€â”€â”€å…¬ç½‘åœ°å€â”€â”€â”€â”€   â”‚ (Public) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     1.2.3.4:5000   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†‘
                                      â”‚ æ³¨å†Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     6.7.8.9:6000        â”‚
â”‚ Client B â”‚ â†â”€â”€â”€å…¬ç½‘åœ°å€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ (NAT-B)  â”‚ â”€â”€â”€â”€æ³¨å†Œâ”€â”€â”€â”€â”€â”€â”€â†’
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ 2 æ­¥ï¼šæœåŠ¡å™¨åè°ƒæ‰“æ´
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client A â”‚ â†â”€â”€â”€PUNCH æŒ‡ä»¤â”€â”€â”€  â”‚  Server  â”‚
â”‚          â”‚    ç›®æ ‡ï¼š6.7.8.9:6000  â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                â†“
     â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                          â”‚ Client B â”‚
     â”‚        PUNCH æŒ‡ä»¤ â”€â”€â”€â”€â”€â†’ â”‚          â”‚
     â”‚        ç›®æ ‡ï¼š1.2.3.4:5000  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“

ç¬¬ 3 æ­¥ï¼šåŒæ–¹åŒæ—¶å‘é€ UDP æ‰“æ´åŒ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client A â”‚ â”€â”€â”€ UDP åŒ… â”€â”€â†’ X   â”‚ NAT-B    â”‚
â”‚          â”‚      (æ‰“æ´åŒ…)       â”‚          â”‚
â”‚          â”‚                    â”‚  å¼€æ”¾æ˜ å°„ â”‚
â”‚          â”‚                    â”‚  6.7.8.9:6000 â†’ B
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                                â†“
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
NAT-A â”‚  â”‚  Server  â”‚        â”‚ Client B â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å¼€æ”¾æ˜ å°„                          â†“
1.2.3.4:5000 â†’ A                 å‘é€æ‰“æ´åŒ…
     â†‘                                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UDP åŒ… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ 4 æ­¥ï¼šP2P ç›´è¿å»ºç«‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client A â”‚ â†â”€â”€â”€â”€â”€ P2P â”€â”€â”€â”€â”€â†’  â”‚ Client B â”‚
â”‚          â”‚      ç›´æ¥é€šä¿¡       â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ å¼€å‘ä¸è´¡çŒ®

### é¡¹ç›®ç»“æ„

```
lightweight-tunnel/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ lightweight-tunnel/
â”‚       â””â”€â”€ main.go                # ç¨‹åºå…¥å£
â”œâ”€â”€ internal/
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ config.go              # é…ç½®ç®¡ç†
â”‚       â””â”€â”€ config_test.go         # é…ç½®æµ‹è¯•
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ crypto/
â”‚   â”‚   â”œâ”€â”€ crypto.go              # AES-256-GCM åŠ å¯†
â”‚   â”‚   â””â”€â”€ crypto_test.go
â”‚   â”œâ”€â”€ faketcp/
â”‚   â”‚   â”œâ”€â”€ faketcp.go             # TCP ä¼ªè£…å®ç°
â”‚   â”‚   â””â”€â”€ faketcp_test.go
â”‚   â”œâ”€â”€ fec/
â”‚   â”‚   â””â”€â”€ fec.go                 # FEC çº é”™ç®—æ³•
â”‚   â”œâ”€â”€ p2p/
â”‚   â”‚   â”œâ”€â”€ manager.go             # P2P è¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ peer.go                # å¯¹ç­‰èŠ‚ç‚¹
â”‚   â”‚   â””â”€â”€ peer_test.go
â”‚   â”œâ”€â”€ routing/
â”‚   â”‚   â”œâ”€â”€ table.go               # è·¯ç”±è¡¨
â”‚   â”‚   â””â”€â”€ table_test.go
â”‚   â”œâ”€â”€ tcp_disguise/
â”‚   â”‚   â””â”€â”€ tcp_disguise.go        # TCP ä¼ªè£…å¤´éƒ¨
â”‚   â””â”€â”€ tunnel/
â”‚       â”œâ”€â”€ tunnel.go              # éš§é“ä¸»é€»è¾‘
â”‚       â””â”€â”€ tun.go                 # TUN è®¾å¤‡ç®¡ç†
â”œâ”€â”€ Makefile                        # æ„å»ºè„šæœ¬
â”œâ”€â”€ README.md                       # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ SECURITY.md                     # å®‰å…¨æ–‡æ¡£
â”œâ”€â”€ LICENSE                         # MIT è®¸å¯è¯
â””â”€â”€ go.mod                          # Go æ¨¡å—ä¾èµ–
```

### ç¼–è¯‘ä¸æµ‹è¯•

```bash
# å®‰è£…ä¾èµ–
go mod download

# ç¼–è¯‘
make build

# è¿è¡Œæµ‹è¯•
make test

# æˆ–è€…ç›´æ¥è¿è¡Œ Go æµ‹è¯•
go test -v ./...

# ç¼–è¯‘ç‰¹å®šå¹³å°
GOOS=linux GOARCH=amd64 go build -o lightweight-tunnel-linux-amd64 ./cmd/lightweight-tunnel
GOOS=linux GOARCH=arm64 go build -o lightweight-tunnel-linux-arm64 ./cmd/lightweight-tunnel
```

### ä»£ç è§„èŒƒ

```bash
# æ ¼å¼åŒ–ä»£ç 
go fmt ./...

# é™æ€æ£€æŸ¥
go vet ./...

# ä½¿ç”¨ golintï¼ˆéœ€è¦å®‰è£…ï¼‰
golint ./...
```

### è´¡çŒ®æŒ‡å—

1. **Fork æœ¬ä»“åº“**
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯** (`git checkout -b feature/AmazingFeature`)
3. **æäº¤æ›´æ”¹** (`git commit -m 'Add some AmazingFeature'`)
4. **æ¨é€åˆ°åˆ†æ”¯** (`git push origin feature/AmazingFeature`)
5. **å¼€å¯ Pull Request**

### æŠ¥å‘Šé—®é¢˜

å‘ç° Bug æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Ÿè¯· [åˆ›å»º Issue](https://github.com/openbmx/lightweight-tunnel/issues)ã€‚

**Issue æ¨¡æ¿**ï¼š
```markdown
### é—®é¢˜æè¿°
ç®€è¦æè¿°é‡åˆ°çš„é—®é¢˜

### é‡ç°æ­¥éª¤
1. æ‰§è¡Œå‘½ä»¤ '...'
2. çœ‹åˆ°é”™è¯¯ '...'

### æœŸæœ›è¡Œä¸º
æè¿°æ‚¨æœŸæœ›å‘ç”Ÿä»€ä¹ˆ

### ç³»ç»Ÿä¿¡æ¯
- OS: Ubuntu 22.04
- Go ç‰ˆæœ¬: 1.21
- é¡¹ç›®ç‰ˆæœ¬: 1.0.0

### æ—¥å¿—è¾“å‡º
ç²˜è´´ç›¸å…³æ—¥å¿—
```

---

## ğŸ“š å‚è€ƒèµ„æ–™ä¸è‡´è°¢

### çµæ„Ÿæ¥æº

æœ¬é¡¹ç›®çš„è®¾è®¡çµæ„Ÿå’ŒæŠ€æœ¯æ–¹æ¡ˆå‚è€ƒäº†ä»¥ä¸‹ä¼˜ç§€å¼€æºé¡¹ç›®ï¼š

- **[udp2raw](https://github.com/wangyu-/udp2raw)** - UDP æµé‡ä¼ªè£…ä¸º TCP çš„å…ˆé©±é¡¹ç›®
- **[tinyfecVPN](https://github.com/wangyu-/tinyfecVPN)** - è½»é‡çº§ FEC VPN å®ç°

### æŠ€æœ¯å¯¹æ¯”

| ç‰¹æ€§ | Lightweight Tunnel | udp2raw | tinyfecVPN |
|------|-------------------|---------|------------|
| **ä¼ è¾“åè®®** | UDP | UDP (å¯é€‰ ICMP) | UDP |
| **TCP ä¼ªè£…** | âœ… ç®€åŒ–å®ç° | âœ… å®Œæ•´ raw socket | âŒ |
| **å†…ç½®åŠ å¯†** | âœ… AES-256-GCM | âŒ | âŒ |
| **FEC çº é”™** | âœ… XOR-based | âŒ | âœ… Reed-Solomon |
| **P2P æ‰“æ´** | âœ… æœåŠ¡å™¨åè°ƒ | âŒ | âŒ |
| **å¤šå®¢æˆ·ç«¯ Hub** | âœ… åŸç”Ÿæ”¯æŒ | âŒ | âŒ |
| **TUN/TAP** | âœ… TUN | âŒ | âœ… TAP |
| **ç¼–ç¨‹è¯­è¨€** | Go | C++ | C++ |
| **è·¨å¹³å°** | å®¹æ˜“ï¼ˆGoï¼‰| å›°éš¾ï¼ˆC++ï¼‰| å›°éš¾ï¼ˆC++ï¼‰|
| **å­¦ä¹ æ›²çº¿** | ä½ | ä¸­ | ä¸­ |

### ç›¸å…³æ–‡æ¡£

- [RFC 793 - TCP Protocol](https://datatracker.ietf.org/doc/html/rfc793)
- [RFC 768 - UDP Protocol](https://datatracker.ietf.org/doc/html/rfc768)
- [RFC 3489 - STUN (NAT Traversal)](https://datatracker.ietf.org/doc/html/rfc3489)
- [Reed-Solomon FEC](https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction)

---

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

```
MIT License

Copyright (c) 2024 openbmx

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

## ğŸ”’ å®‰å…¨å£°æ˜

è¯¦ç»†çš„å®‰å…¨ä¿¡æ¯å’Œå»ºè®®è¯·å‚é˜… [SECURITY.md](SECURITY.md) æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š

- âœ… åŠ å¯†é…ç½®æœ€ä½³å®è·µ
- âš ï¸ ISP å’Œ DPI ç›‘æ§è€ƒé‡
- ğŸ›¡ï¸ å¨èƒæ¨¡å‹å’Œé˜²æŠ¤æªæ–½
- ğŸ“‹ å®‰å…¨æ¼æ´æŠ¥å‘Šæµç¨‹

**é‡è¦æç¤º**ï¼š
1. **ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…å¯ç”¨åŠ å¯†** (`-k` å‚æ•°)
2. **ä½¿ç”¨å¼ºå¯†ç ** - 16+ å­—ç¬¦ï¼ŒåŒ…å«å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
3. **å®šæœŸæ›´æ¢å¯†é’¥** - å»ºè®®æ¯ 3-6 ä¸ªæœˆæ›´æ¢ä¸€æ¬¡
4. **ç›‘æ§å¼‚å¸¸æµé‡** - åŠæ—¶å‘ç°æ½œåœ¨çš„å®‰å…¨é—®é¢˜

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub Issues**: [æäº¤é—®é¢˜æˆ–å»ºè®®](https://github.com/openbmx/lightweight-tunnel/issues)
- **Pull Requests**: [è´¡çŒ®ä»£ç ](https://github.com/openbmx/lightweight-tunnel/pulls)
- **Discussions**: [æŠ€æœ¯è®¨è®º](https://github.com/openbmx/lightweight-tunnel/discussions)

---

## ğŸŒŸ Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ Starï¼

[![Star History Chart](https://api.star-history.com/svg?repos=openbmx/lightweight-tunnel&type=Date)](https://star-history.com/#openbmx/lightweight-tunnel&Date)

---

<div align="center">

**æ„Ÿè°¢ä½¿ç”¨ Lightweight Tunnelï¼**

Made with â¤ï¸ by the Lightweight Tunnel Team

[â¬† è¿”å›é¡¶éƒ¨](#lightweight-tunnel---è½»é‡çº§å†…ç½‘ç©¿é€éš§é“)

</div>
